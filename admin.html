<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ê´€ë¦¬ì ì£¼ë¬¸ í˜ì´ì§€</title>
<style>
body {
  font-family: Arial, sans-serif;
  background: #f5f5f5;
  margin: 0;
  padding: 20px;
}
h1 {
  text-align: center;
}
.order {
  background: white;
  border-radius: 10px;
  padding: 15px;
  margin-bottom: 15px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.1);
}
.new {
  border-left: 6px solid #ff4d4f;
}
.done {
  opacity: 0.5;
}
button {
  margin-top: 10px;
  padding: 6px 12px;
  border: none;
  border-radius: 6px;
  background: #1a73e8;
  color: white;
  cursor: pointer;
}
button.done {
  background: #999;
}
</style>
</head>
<body>

<h1>ğŸ“‹ ì‹¤ì‹œê°„ ì£¼ë¬¸ í˜„í™©</h1>
<div id="orders"></div>

<audio id="alarm" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg"></audio>

<script>
let lastOrderId = 0;

async function loadOrders() {
  const res = await fetch("http://localhost:3000/orders");
  const data = await res.json();
  const box = document.getElementById("orders");
  box.innerHTML = "";

  data.forEach(order => {
    const div = document.createElement("div");
    div.className = "order " + (order.status === "NEW" ? "new" : "done");

    let itemsHtml = order.items.map(i =>
      `â€¢ ${i.name} Ã— ${i.qty}`
    ).join("<br>");

    div.innerHTML = `
      <strong>ğŸª‘ í…Œì´ë¸” ${order.table}</strong><br>
      â° ${order.time}<br><br>
      ${itemsHtml}<br>
      ğŸ“ ${order.request || "ìš”ì²­ ì—†ìŒ"}
      <br>
      ${order.status === "NEW"
        ? `<button onclick="doneOrder(${order.id})">POS ì…ë ¥ ì™„ë£Œ</button>`
        : `<button class="done">ì²˜ë¦¬ë¨</button>`
      }
    `;

    box.appendChild(div);
  });

  if (data.length && data[0].id > lastOrderId) {
    document.getElementById("alarm").play();
    lastOrderId = data[0].id;
  }
}

async function doneOrder(id) {
  await fetch(`http://localhost:3000/order/done/${id}`, { method: "POST" });
  loadOrders();
}

/* 5ì´ˆë§ˆë‹¤ ìë™ ìƒˆë¡œê³ ì¹¨ */
setInterval(loadOrders, 5000);
loadOrders();
</script>

</body>
</html>
